const svgList = {
  config: "node_modules/remixicon/icons/System/settings-3-fill.svg",
  donate: "node_modules/remixicon/icons/Finance/copper-coin-fill.svg",
  general: "node_modules/remixicon/icons/Business/global-fill.svg",
  images: "node_modules/remixicon/icons/Media/image-fill.svg",
  videos: "node_modules/remixicon/icons/Media/video-fill.svg",
  news: "node_modules/remixicon/icons/Document/newspaper-fill.svg",
  music: "node_modules/remixicon/icons/Media/music-2-fill.svg",
  search: "node_modules/remixicon/icons/System/search-line.svg",
  close: "node_modules/remixicon/icons/System/close-line.svg",
  plugin: "node_modules/remixicon/icons/Development/puzzle-2-fill.svg",
  info: "node_modules/remixicon/icons/System/information-2-fill.svg",
  database: "node_modules/remixicon/icons/Device/database-2-fill.svg",
  share: "node_modules/remixicon/icons/System/share-fill.svg",
  ai: "node_modules/remixicon/icons/System/apps-2-ai-fill.svg",
  send: "node_modules/remixicon/icons/Business/send-plane-2-fill.svg",
  stop: "node_modules/remixicon/icons/Media/pause-circle-line.svg",
  back: "node_modules/remixicon/icons/Arrows/arrow-go-back-fill.svg",
  eye: "node_modules/remixicon/icons/System/eye-fill.svg",
  user: "node_modules/remixicon/icons/User & Faces/user-6-fill.svg",
  loader: "node_modules/remixicon/icons/System/loader-line.svg",
  information: "node_modules/remixicon/icons/System/information-fill.svg",
  check: "node_modules/remixicon/icons/System/check-line.svg",
  more: "node_modules/remixicon/icons/System/more-2-fill.svg",
};

const ejs = require("ejs"),
  svgo = require("svgo"),
  fs = require("fs");

const icons = {};

for (const iconName in svgList) {
  const svgFileName = svgList[iconName];
  try {
    const svgContent = fs.readFileSync(svgFileName, { encoding: "utf8" });
    const svgoResult = svgo.optimize(svgContent, {
      path: svgFileName,
      multipass: true,
      plugins: [
        {
          name: "removeTitle",
        },
        {
          name: "removeXMLNS",
        },
        {
          name: "addAttributesToSVGElement",
          params: {
            attributes: [{ class: "icon", "aria-hidden": "true" }],
          },
        },
      ],
    });
    icons[iconName] = svgoResult.data.replace("'", "\\'");
  } catch (err) {
    console.error(`Error while processing ${svgFileName}`);
    Object.keys(icons).forEach((key) => {
      delete icons[key];
    });
    break;
  }
}

const template = `{# this file was generated by svg2jinja.js #}
{%- set icons = {
<% for (const iconName in icons) { %>  '<%- iconName %>':'<%- icons[iconName] %>',
<% } %>
}
-%}

{% macro icon(action, alt) -%}
  {{ icons[action] | safe }}
{%- endmacro %}

{% macro icon_small(action) -%}
  {{ icons[action] | replace("icon", "icon-small") | safe }}
{%- endmacro %}

{% macro icon_big(action, alt) -%}
{{ icons[action] | replace("icon", "icon-big") | safe }}
{%- endmacro %}
`;

const result = ejs.render(template, { icons });
fs.writeFileSync("../../../templates/smart/icons.html", result, {
  encoding: "utf8",
});

if (Object.keys(icons).length > 0) {
  console.log("Successfully generated icons.html");
}
